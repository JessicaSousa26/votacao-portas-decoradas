<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Encerramento â€” VotaÃ§Ã£o Natalina</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sofia:wght@400;700&display=swap" rel="stylesheet">

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/11.0.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore-compat.js"></script>
  <script src="./js/firebase.js"></script>

  <style>
    :root{ --green:#0f766e; --gold:#d97706; }
    body{margin:0;background:#f8fffb;color:#0f766e;font-family:"Sofia",system-ui,sans-serif;overflow:hidden;}
    .wrap{position:relative;min-height:100svh;display:flex;align-items:center;justify-content:center;padding:24px;}
    .panel{position:relative;max-width:880px;background:#ffffffee;border:1px solid #d1fae5;border-radius:24px;padding:28px 22px;
           box-shadow:0 20px 40px rgba(16,185,129,.12);text-align:center;z-index:2;}
    h1{margin:.2em 0;font-size:clamp(22px,4.5vw,44px);color:#065f46}
    p{margin:.5em 0 1em;color:#0f766e;font-size:clamp(14px,2.2vw,18px)}
    .btns{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}
    .btn{background:var(--green);color:#fff;border:none;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer}
    .btn:hover{background:#0b5e57}
    .btn-outline{background:transparent;color:var(--gold);border:2px solid var(--gold)}
    .btn-outline:hover{background:rgba(217,119,6,.08)}
    .hero{position:absolute;inset:0;z-index:1;overflow:hidden;pointer-events:none}
    .hero img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:.18;filter:contrast(105%) saturate(110%)}
    /* Snow */
    .snowflake{position:fixed;top:-10px;color:white;font-size:1em;pointer-events:none;z-index:3;animation:fall linear forwards;opacity:.85;filter:drop-shadow(0 0 4px rgba(255,255,255,.9));}
    @keyframes fall{to{transform:translateY(100vh) rotate(360deg);opacity:.7;}}
    /* Sparkles */
    .sparkle{position:absolute;width:6px;height:6px;background:radial-gradient(white 40%,transparent 60%);border-radius:50%;
             animation:sparkle 2s infinite ease-in-out;pointer-events:none;filter:drop-shadow(0 0 4px rgba(255,255,255,.8));z-index:2;}
    @keyframes sparkle{0%,100%{opacity:0;transform:scale(.2);}50%{opacity:1;transform:scale(1);}}
    /* Fireworks canvas */
    canvas#fw{position:fixed;inset:0;z-index:1;pointer-events:none}
    footer.rodape{position:fixed;left:0;right:0;bottom:0;text-align:center;padding:10px 12px;background:linear-gradient(180deg,rgba(255,255,255,0),#fff 60%);z-index:4}
    footer .txt{font-weight:700;color:#b8860b;text-shadow:0 0 10px rgba(255,215,0,0.8), 0 0 25px rgba(255,255,255,0.4);}
  
  /* === QR Code flutuante === */
  #qrcode-fixo{position:fixed;bottom:20px;right:20px;z-index:1000;background:rgba(255,255,255,.9);border:2px solid #d4af37;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.3);padding:8px;animation:qrGlow 3s infinite alternate;}
  #qrcode-fixo img{width:100px;height:100px;display:block}
  @keyframes qrGlow{0%{box-shadow:0 0 8px #d4af37;}100%{box-shadow:0 0 24px #ffecb3;}}
  #qrcode-fixo[data-tip]{position:fixed}
  #qrcode-fixo[data-tip]::after{content:attr(data-tip);position:absolute;bottom:110%;right:0;white-space:nowrap;background:#111827;color:#fff;padding:6px 10px;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,.25);opacity:0;transform:translateY(6px);transition:.2s;pointer-events:none;font-size:12px}
  #qrcode-fixo[data-tip]:hover::after{opacity:1;transform:translateY(0)}

  
  /* RÃ³tulo do QR flutuante */
  #qrcode-fixo{display:flex;flex-direction:column;align-items:center;gap:6px}
  #qrcode-fixo .qr-label{font-size:12px;color:#374151;font-weight:700;white-space:nowrap}
  @media (max-width: 520px){
    #qrcode-fixo .qr-label{display:none}
  }

  </style>
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#0f766e">
  <link rel="icon" type="image/png" sizes="32x32" href="./assets/favicon.png">
  <link rel="apple-touch-icon" href="./assets/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <img src="./assets/hero-natal.jpg" alt="Natal">
      <div id="sparkLayer"></div>
      <canvas id="fw"></canvas>
    </div>

    <div class="panel">
      <h1>ðŸŽ„ VotaÃ§Ã£o de Natal 2025 Encerrada!</h1>
      <p>Obrigada a todos os vizinhos que participaram enviando fotos e votando. Foi lindo ver a criatividade de cada andar! ðŸ’š</p>
      <p>Em breve divulgaremos o resultado oficial. AtÃ© lÃ¡, desejamos um Natal abenÃ§oado e um Ano Novo cheio de paz e alegria!</p>
      <div class="btns">
        <a href="./ranking.html" class="btn">Ver Ranking</a>
        <a href="./index.html" class="btn btn-outline">Voltar para a Galeria</a>
      </div>
    </div>
  </div>

  <footer class="rodape">
    <div class="txt">Â© Todos os direitos reservados 2025 | Desenvolvido por JÃ©ssica Maria de Sousa | ComissÃ£o de Natal - Torre 4</div>
  </footer>

  <audio id="audioSino" src="./assets/sininhos.mp3" preload="auto" loop></audio>

  <script>
    // Verifica perÃ­odo; se ainda nÃ£o acabou, redireciona para index
    const db = firebase.firestore();
    (async () => {
      try {
        const s = await db.collection('settings').doc('votacao').get();
        if (s.exists) {
          const { fim } = s.data();
          const agora = firebase.firestore.Timestamp.now();
          if (agora < fim) {
            location.href = "./index.html";
            return;
          }
        }
      } catch (e) {}
      startScene();
    })();

    function startScene(){
      // Sinos
      const a = document.getElementById('audioSino');
      a.volume = 0.15;
      const somAtivo = localStorage.getItem('somNatal') === 'true';
      if (somAtivo) a.play().catch(()=>{});

      // Neve
      const snowContainer = document.createElement('div'); document.body.appendChild(snowContainer);
      let snowTimer=null;
      function createSnowflake(){const f=document.createElement('div');f.className='snowflake';f.textContent='â„';
        f.style.left=Math.random()*100+'vw';f.style.fontSize=(8+Math.random()*16)+'px';f.style.animationDuration=(6+Math.random()*6)+'s';
        snowContainer.appendChild(f); setTimeout(()=>f.remove(),12000);}
      for(let i=0;i<12;i++) createSnowflake();
      snowTimer=setInterval(createSnowflake,300);

      // Sparkles
      const sparkLayer=document.getElementById('sparkLayer');
      for(let i=0;i<24;i++){const d=document.createElement('div');d.className='sparkle';
        d.style.left=Math.random()*100+'%';d.style.top=Math.random()*100+'%';d.style.animationDelay=Math.random()*3+'s';sparkLayer.appendChild(d);}

      // Fogos (leve, canvas)
      const canvas=document.getElementById('fw'), ctx=canvas.getContext('2d');
      let w=canvas.width=innerWidth, h=canvas.height=innerHeight;
      addEventListener('resize',()=>{w=canvas.width=innerWidth;h=canvas.height=innerHeight;});
      const particles=[];
      function burst(x,y,color){for(let i=0;i<90;i++){const ang=Math.random()*Math.PI*2;const sp=1+Math.random()*3;
        particles.push({x,y,vx:Math.cos(ang)*sp,vy:Math.sin(ang)*sp,life:60,color});}}
      function loop(){
        ctx.fillStyle='rgba(0,0,0,0.08)';ctx.fillRect(0,0,w,h); // leve fade
        for(let i=particles.length-1;i>=0;i--){
          const p=particles[i]; p.x+=p.vx; p.y+=p.vy; p.vy+=0.01; p.life--;
          ctx.beginPath(); ctx.fillStyle=p.color; ctx.arc(p.x,p.y,2,0,6.283); ctx.fill();
          if(p.life<=0) particles.splice(i,1);
        }
        requestAnimationFrame(loop);
      }
      setInterval(()=>{
        const x=Math.random()*w, y=Math.random()*h*0.5+50;
        const golds=['#ffd166','#ffec99','#ffe08a','#facc15','#f59e0b'];
        burst(x,y,golds[Math.floor(Math.random()*golds.length)]);
      },1200);
      loop();
    }
  </script>
  <div id="qrcode-fixo" data-tip="Aponte a cÃ¢mera para abrir a votaÃ§Ã£o"><img src="./img/qrcode.png" alt="QR Code VotaÃ§Ã£o Natalina"></div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const qr = document.getElementById('qrcode-fixo');
    if (qr) qr.style.display = 'none';
  });
</script>

  <script>if('serviceWorker' in navigator){window.addEventListener('load',()=>navigator.serviceWorker.register('./sw.js').catch(()=>{}));}</script>
</body>
</html>
